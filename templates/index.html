<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="https://raw.githubusercontent.com/Toperlock/sing-box-subscribe/main/public/favicon.ico" type="image/x-icon">
    <title>生成sing-box配置</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 100%;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
            position: relative;
            overflow: hidden;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://www.bing.com/th?id=OHR.');
            background-size: cover;
            background-position: center;
            filter: blur(25px);
            z-index: -1;
        }
        
        .container {
            display: flex;
            flex-direction: row;
            align-items: center;
            z-index: 1;
            background-color: rgba(255, 255, 255, 0.7);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
        }
        
        .right-box {
            flex: 2;
            padding: 20px;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        textarea {
            width: 100%;
            min-height: 300px;
            font-family: monospace;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        
        select, input[type="submit"] {
            padding: 8px 12px;
            margin: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        
        input[type="submit"], button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        
        input[type="submit"]:hover, button:hover {
            background-color: #45a049;
        }
        
        .config-content {
            margin-top: 20px;
        }
        
        pre {
            background-color: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 15px;
            border-radius: 5px;
            overflow: auto;
            max-height: 400px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        @media screen and (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .right-box {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="right-box">
            <h1>编辑 TEMP_JSON_DATA</h1>
            <form id="temp-json-form" method="POST" action="/edit_temp_json">
                <textarea name="temp_json_data" rows="10" cols="40">{{ temp_json_data | default('') }}</textarea>
                <br>
                <input type="submit" value="保存">
            </form>
            <div class="form-container" style="display: flex; align-items: center;">
                <form method="POST" action="/generate_config" style="display: flex; align-items: center;">
                    <select name="template_index">
                        {% for option in template_options %}
                        <option value="{{ loop.index - 1 }}">{{ option }}</option>
                        {% endfor %}
                    </select>
                    <input type="submit" value="选择并生成">
                </form>
            </div>
        </div>
        <div class="config-content">
            <pre id="config-text"></pre>
        </div>
    </div>
    <script>
        // 获取Bing每日图片URL并设置为背景
        async function setBingBackground() {
            try {
                // Bing API获取每日壁纸
                const response = await fetch('https://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&mkt=en-US');
                const data = await response.json();
                const imageUrl = 'https://www.bing.com' + data.images[0].url;
                
                // 设置背景
                document.body.style.backgroundImage = `url('${imageUrl}')`;
            } catch (error) {
                console.error('无法获取Bing背景图片:', error);
                // 如果获取失败，使用默认背景
                document.body.style.backgroundColor = '#f2f2f2';
            }
        }

        // 页面加载完成后设置背景
        window.onload = setBingBackground;

        const initialTempJsonData = '{"subscribes":[{"url":"URL","tag":"tag_1","enabled":true,"emoji":1,"subgroup":"","prefix":"","User-Agent":"v2rayng"},{"url":"URL","tag":"tag_2","enabled":false,"emoji":0,"subgroup":"命名/named","prefix":"❤️","User-Agent":"clashmeta"}],"auto_set_outbounds_dns":{"proxy":"","direct":""},"save_config_path":"./config.json","auto_backup":false,"exclude_protocol":"ssr","config_template":"","Only-nodes":false}';
        let tempJsonData = initialTempJsonData;
        document.querySelector('#temp-json-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const response = await fetch(form.action, {
                method: form.method,
                body: formData,
            });
            if (response.ok) {
                const responseData = await response.text();
                const configContent = document.querySelector('#config-text');
                configContent.textContent = responseData
            }
        });
    </script>
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul class="flashes">
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
</body>
</html>



